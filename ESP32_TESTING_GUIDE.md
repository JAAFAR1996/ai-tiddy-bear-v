# دليل فحص ESP32 - AI Teddy Bear

## نظرة عامة

هذا الدليل يشرح كيفية استخدام أدوات فحص ESP32 للتأكد من عمل جميع الطلبات والخدمات بشكل صحيح.

## الأدوات المتاحة

### 1. الفحص الشامل (`esp32_comprehensive_test.py`)
فحص شامل لجميع ESP32 endpoints مع اختبارات مفصلة.

**الميزات:**
- ✅ فحص صحة السيرفر
- 🔧 فحص إعدادات ESP32
- 💾 فحص معلومات الفيرموير
- 🔗 فحص ربط الأجهزة
- 📊 فحص المقاييس
- 💬 فحص WebSocket للدردشة
- 🛣️ فحص صحة الراوترات

**الاستخدام:**
```bash
python esp32_comprehensive_test.py
```

### 2. فحص الأداء (`esp32_performance_test.py`)
قياس أداء وسرعة استجابة ESP32 endpoints.

**الميزات:**
- ⚡ قياس زمن الاستجابة
- 🔄 اختبار التحميل المتزامن
- 📊 إحصائيات مفصلة
- 📈 تقييم الأداء العام

**الاستخدام:**
```bash
python esp32_performance_test.py
```

### 3. المراقبة المستمرة (`esp32_monitor.py`)
مراقبة مستمرة لحالة ESP32 endpoints مع تنبيهات.

**الميزات:**
- 🔄 مراقبة مستمرة
- 🚨 تنبيهات تلقائية
- 📊 إحصائيات في الوقت الفعلي
- 💾 تقارير مفصلة
- ⏰ مراقبة لفترة محددة أو مستمرة

**الاستخدام:**
```bash
# مراقبة مستمرة
python esp32_monitor.py

# مراقبة لمدة 10 دقائق
python esp32_monitor.py --duration 10

# تغيير فترة الفحص إلى 15 ثانية
python esp32_monitor.py --interval 15
```

### 4. التشغيل الشامل (`run_esp32_tests.py`)
سكريبت موحد لتشغيل جميع الاختبارات.

**الميزات:**
- 🚀 تشغيل جميع الاختبارات
- 📋 تقرير شامل
- 🎯 تشغيل اختبار واحد
- ⚙️ خيارات متقدمة

**الاستخدام:**
```bash
# تشغيل جميع الاختبارات
python run_esp32_tests.py

# تشغيل اختبار واحد فقط
python run_esp32_tests.py --test comprehensive

# تخطي المراقبة
python run_esp32_tests.py --no-monitoring

# تغيير رابط السيرفر
python run_esp32_tests.py --url http://localhost:8080
```

## إعداد البيئة

### المتطلبات
```bash
pip install requests websockets
```

### إعدادات السيرفر
تأكد من أن السيرفر يعمل على:
- **المضيف:** `127.0.0.1` أو `localhost`
- **البورت:** `8000` (افتراضي)
- **البروتوكول:** HTTP

## ESP32 Endpoints المدعومة

### 1. الصحة العامة
- **URL:** `/health`
- **الطريقة:** GET
- **الوصف:** فحص صحة السيرفر العامة

### 2. إعدادات ESP32
- **URL:** `/api/v1/esp32/config`
- **الطريقة:** GET
- **الوصف:** الحصول على إعدادات ESP32
- **المصادقة:** غير مطلوبة

### 3. معلومات الفيرموير
- **URL:** `/api/v1/esp32/firmware`
- **الطريقة:** GET
- **الوصف:** معلومات الفيرموير المتاح
- **المصادقة:** غير مطلوبة

### 4. ربط الجهاز
- **URL:** `/api/v1/pair/claim`
- **الطريقة:** POST
- **الوصف:** ربط جهاز ESP32 جديد
- **المصادقة:** HMAC مطلوب

### 5. مقاييس ESP32
- **URL:** `/api/v1/esp32/metrics`
- **الطريقة:** GET
- **الوصف:** مقاييس أداء ESP32
- **المصادقة:** مطلوبة

### 6. WebSocket للدردشة
- **URL:** `/api/v1/esp32/chat`
- **البروتوكول:** WebSocket
- **الوصف:** دردشة مباشرة مع ESP32
- **المصادقة:** Token مطلوب

### 7. صحة الراوترات
- **URL:** `/routes-health`
- **الطريقة:** GET
- **الوصف:** فحص صحة جميع الراوترات

## أمثلة الاستخدام

### فحص سريع
```bash
# فحص شامل سريع
python esp32_comprehensive_test.py
```

### فحص الأداء
```bash
# فحص أداء مفصل
python esp32_performance_test.py
```

### مراقبة قصيرة المدى
```bash
# مراقبة لمدة 5 دقائق
python esp32_monitor.py --duration 5 --interval 10
```

### تشغيل شامل
```bash
# تشغيل جميع الاختبارات مع مراقبة 3 دقائق
python run_esp32_tests.py --monitoring-duration 3
```

## تفسير النتائج

### رموز الحالة
- ✅ **نجح:** الاختبار نجح بدون مشاكل
- ⚠️ **تحذير:** الاختبار نجح مع ملاحظات
- ❌ **فشل:** الاختبار فشل
- 🔴 **خطأ حرج:** خطأ يتطلب تدخل فوري

### معدلات الأداء
- **ممتاز:** زمن استجابة < 500ms، معدل نجاح > 95%
- **جيد:** زمن استجابة < 1000ms، معدل نجاح > 90%
- **مقبول:** زمن استجابة < 2000ms، معدل نجاح > 80%
- **ضعيف:** زمن استجابة > 2000ms أو معدل نجاح < 80%

## استكشاف الأخطاء

### مشاكل شائعة

#### 1. السيرفر لا يستجيب
```
❌ خطأ في الاتصال بالسيرفر: Connection refused
```
**الحل:**
- تأكد من تشغيل السيرفر
- تحقق من البورت الصحيح
- تأكد من عدم وجود جدار حماية

#### 2. مهلة انتهاء الطلب
```
⏰ انتهت مهلة انتظار الرد
```
**الحل:**
- تحقق من حمولة السيرفر
- زيادة timeout في الإعدادات
- فحص اتصال الشبكة

#### 3. خطأ في المصادقة
```
❌ مصادقة فاشلة: Invalid token format
```
**الحل:**
- تحقق من إعدادات ESP32_SHARED_SECRET
- تأكد من صحة HMAC generation
- فحص بيانات الجهاز

#### 4. WebSocket فشل في الاتصال
```
❌ تم إغلاق الاتصال: 403 Forbidden
```
**الحل:**
- تحقق من token صحيح
- تأكد من معاملات الاتصال
- فحص إعدادات CORS

## التقارير والسجلات

### ملفات التقارير
- `esp32_test_report_YYYYMMDD_HHMMSS.json`: تقرير شامل
- `esp32_monitor_report_YYYYMMDD_HHMMSS.json`: تقرير المراقبة
- `esp32_monitor.log`: سجل المراقبة

### محتوى التقارير
```json
{
  "test_session": {
    "start_time": "2025-01-XX...",
    "end_time": "2025-01-XX...",
    "total_duration": 120.5,
    "base_url": "http://127.0.0.1:8000"
  },
  "summary": {
    "total_tests": 4,
    "successful_tests": 3,
    "failed_tests": 1,
    "success_rate": 75.0
  },
  "test_results": {...}
}
```

## الدعم والمساعدة

### معلومات إضافية
- تحقق من سجلات السيرفر للأخطاء التفصيلية
- استخدم `--help` مع أي سكريبت للحصول على المساعدة
- راجع ملفات التقارير للتحليل المفصل

### أوامر المساعدة
```bash
python esp32_comprehensive_test.py --help
python esp32_performance_test.py --help
python esp32_monitor.py --help
python run_esp32_tests.py --help
```

---

**ملاحظة:** تأكد من تشغيل السيرفر قبل بدء أي اختبارات، وتحقق من الإعدادات المطلوبة في متغيرات البيئة.