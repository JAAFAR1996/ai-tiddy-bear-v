[supervisord]
nodaemon=true
user=backup
logfile=/app/logs/supervisord.log
pidfile=/tmp/supervisord.pid
childlogdir=/app/logs

[program:backup-orchestrator]
command=python -m src.infrastructure.backup.orchestrator
directory=/app
user=backup
autostart=true
autorestart=true
startsecs=10
startretries=3
redirect_stderr=true
stdout_logfile=/app/logs/backup-orchestrator.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app",BACKUP_SERVICE_MODE="production"

[program:backup-scheduler]
command=python /app/scripts/backup_scheduler.py
directory=/app
user=backup
autostart=true
autorestart=true
startsecs=10
startretries=3
redirect_stderr=true
stdout_logfile=/app/logs/backup-scheduler.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

[program:backup-monitor]
command=python -m src.infrastructure.backup.monitoring
directory=/app
user=backup
autostart=true
autorestart=true
startsecs=10
startretries=3
redirect_stderr=true
stdout_logfile=/app/logs/backup-monitor.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

[program:backup-testing]
command=python /app/scripts/backup_test_runner.py
directory=/app
user=backup
autostart=false
autorestart=false
redirect_stderr=true
stdout_logfile=/app/logs/backup-testing.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

[program:metrics-exporter]
command=python /app/scripts/metrics_exporter.py
directory=/app
user=backup
autostart=true
autorestart=true
startsecs=5
startretries=3
redirect_stderr=true
stdout_logfile=/app/logs/metrics-exporter.log
stdout_logfile_maxbytes=10MB
stdout_logfile_backups=5
environment=PYTHONPATH="/app"

[unix_http_server]
file=/tmp/supervisor.sock
chmod=0700
chown=backup:backup

[supervisorctl]
serverurl=unix:///tmp/supervisor.sock

[rpcinterface:supervisor]
supervisor.rpcinterface_factory = supervisor.rpcinterface:make_main_rpcinterface