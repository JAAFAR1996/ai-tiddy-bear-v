# ESP32 Issues Analysis & Fixes

## ๐ ุงููุดุงูู ุงูููุชุดูุฉ

### 1. **ูุดููุฉ ุงูุชุนููุฏ ูู ุงููุตุงุฏูุฉ**
- โ ESP32 ูุญุงูู ุงุณุชุฎุฏุงู HMAC ู JWT ูุนุงู
- โ ููุฏ ูุนูุฏ ูุญุณุงุจ HMAC-SHA256
- โ ูุชุทูุจ ููุงุชูุญ ุณุฑูุฉ ูุนูุฏุฉ

**ุงูุญู**: ุชุจุณูุท ุงููุตุงุฏูุฉ ูุชุชุทูุจ ููุท `device_id`

### 2. **ูุดููุฉ ูู WebSocket URL**
- โ ESP32 ูุณุชุฎุฏู `/ws/esp32/connect` 
- โ Server ูุชููุน `/api/v1/esp32/chat`

**ุงูุญู**: ุชุญุฏูุซ ESP32 ููุณุชุฎุฏู ุงููุณุงุฑ ุงูุตุญูุญ

### 3. **ูุดููุฉ ูู ุฅุนุฏุงุฏุงุช ุงูุฎุงุฏู**
- โ ESP32 ูุญุงูู ุงูุงุชุตุงู ุจู `192.168.0.133`
- โ ูุฏ ูุง ูููู ูุฐุง ูู ุนููุงู ุงูุฎุงุฏู ุงูุตุญูุญ

**ุงูุญู**: ุชุญุฏูุซ ุนููุงู ุงูุฎุงุฏู

## ๐๏ธ ุงูุฅุตูุงุญุงุช ุงููุทููุจุฉ

### 1. ุชุญุฏูุซ WebSocket Handler ูู ESP32

```cpp
// ูู websocket_handler.cpp
String wsPath = "/api/v1/esp32/chat";  // ุจุฏูุงู ูู /ws/esp32/connect
wsPath += "?device_id=" + deviceId;
wsPath += "&child_name=" + childName;
wsPath += "&child_age=" + String(childAge);
// ุฅุฒุงูุฉ HMAC token - ูุง ุญุงุฌุฉ ูู
```

### 2. ุชุจุณูุท ุงููุตุงุฏูุฉ

```cpp
// ุฅุฒุงูุฉ ูุฐุง ุงูููุฏ ุงููุนูุฏ:
String token = hmac_sha256_hex_raw(String(ESP32_SHARED_SECRET), deviceId);

// ุงุณุชุฎุฏุงู ุงุชุตุงู ูุจุงุดุฑ ุจุฏูู token
```

### 3. ุชุญุฏูุซ ุนููุงู ุงูุฎุงุฏู

```cpp
// ูู config.h
#define DEFAULT_SERVER_HOST "localhost"  // ุฃู ุนููุงู ุงูุฎุงุฏู ุงูุตุญูุญ
#define DEFAULT_SERVER_PORT 8000
```

## ๐งช ุฎุทุฉ ุงูุงุฎุชุจุงุฑ

### 1. ุงุฎุชุจุงุฑ ุงูุฎุงุฏู
```bash
# ุชุดุบูู ุงูุฎุงุฏู
cd "ai teddy bear"
python -m uvicorn src.main:app --reload --host 0.0.0.0 --port 8000
```

### 2. ุงุฎุชุจุงุฑ ุงูุงุชุตุงู
```bash
# ุชุดุบูู ุงุฎุชุจุงุฑ ESP32
python test_esp32_simplified.py
```

### 3. ุงุฎุชุจุงุฑ WebSocket ูุฏููุงู
```javascript
// ูู ุงููุชุตูุญ
const ws = new WebSocket('ws://localhost:8000/api/v1/esp32/chat?device_id=TEST001&child_name=Ahmed&child_age=8');
ws.onopen = () => console.log('Connected');
ws.onmessage = (e) => console.log('Received:', e.data);
```

## ๐ ูุงุฆูุฉ ุงูุชุญูู

- [ ] ุชุญุฏูุซ WebSocket URL ูู ESP32
- [ ] ุฅุฒุงูุฉ HMAC token ูู ESP32
- [ ] ุชุญุฏูุซ ุนููุงู ุงูุฎุงุฏู
- [ ] ุงุฎุชุจุงุฑ REST endpoints
- [ ] ุงุฎุชุจุงุฑ WebSocket connection
- [ ] ุงุฎุชุจุงุฑ ุชุฏูู ุงูุตูุช
- [ ] ุงุฎุชุจุงุฑ heartbeat

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ

ุจุนุฏ ูุฐู ุงูุฅุตูุงุญุงุช:
- โ ESP32 ูุชุตู ุจุณูููุฉ ุจุฏูู tokens ูุนูุฏุฉ
- โ WebSocket ูุนูู ูุน device_id ููุท
- โ ุชุฏูู ุงูุตูุช ูุนูู ุจุดูู ุทุจูุนู
- โ ุงููุธุงู ุฃุจุณุท ูุฃูุซุฑ ุงุณุชูุฑุงุฑุงู