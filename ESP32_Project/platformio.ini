[env:esp32dev-release]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
; Lower upload speed for reliability on Windows/USB cables
; Further reduce for stability on this machine
upload_speed = 115200

; Build flags for production - optimized for size and security
build_type = release
build_unflags = -flto
build_flags =
    -fno-lto
    -Os
    -DCORE_DEBUG_LEVEL=0
    -DCONFIG_ARDUHAL_LOG_COLORS=0
    -DPRODUCTION_MODE=1
    -DPRODUCTION_BUILD=1
    -DUSE_SSL=1
    -DWIFI_SSID_MAX_LEN=32
    -DWIFI_PASSWORD_MAX_LEN=64
    -DLOG_LOCAL_LEVEL=ESP_LOG_WARN
    -DESP_LOG_MAXIMUM_LEVEL=ESP_LOG_WARN
    -DCONFIG_MBEDTLS_CERTIFICATE_BUNDLE=1
    -DMBEDTLS_DEBUG=0
    -DARDUINO_LOOP_STACK_SIZE=16384
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
    -DNDEBUG

; Libraries - optimized (removed unused libraries)
lib_deps = 
    ArduinoJson@^6.21.3
    WebSockets@^2.4.0
    ayushsharma82/ElegantOTA@^2.2.9
    ; h2zero/NimBLE-Arduino@^1.4.1  ; ‚ùå Removed - Audio-only teddy bear
    densaugeo/base64@^1.4.0
    tzapu/WiFiManager@^2.0.17
    arduino-libraries/NTPClient@^3.2.1
    bblanchon/StreamUtils@^1.7.3

; Serial monitor settings
monitor_filters = 
    esp32_exception_decoder
    time

; Upload settings
upload_protocol = esptool
upload_port = COM5
upload_flags = 
    --chip=esp32
    --before=default_reset
    --after=hard_reset
    --connect-attempts=10

; Debug settings for development
debug_tool = esp-prog
debug_init_break = tbreak setup

; Filesystem settings - Use larger app partition
board_build.filesystem = littlefs
board_build.partitions = huge_app.csv

; Advanced settings
board_build.f_cpu = 240000000L
board_build.f_flash = 80000000L
board_build.flash_mode = dio

# Local development environment (connects to localhost:8000 over ws, no TLS)
[env:esp32dev-local]
platform = espressif32
board = esp32dev
framework = arduino
monitor_speed = 115200
upload_speed = 115200
build_type = debug
build_unflags = -flto
build_flags =
    -fno-lto
    -O0
    -DCORE_DEBUG_LEVEL=4
    -DCONFIG_ARDUHAL_LOG_COLORS=1
    -DDEBUG_BUILD=1
    -DLOCAL_BUILD=1
    -DPRODUCTION_MODE=0
    -DUSE_SSL=0
    -DDEFAULT_SERVER_HOST=\"192.168.0.188\"
    -DDEFAULT_SERVER_PORT=8000
    -DLOG_LOCAL_LEVEL=ESP_LOG_INFO
    -DARDUINO_LOOP_STACK_SIZE=16384
    -ffunction-sections
    -fdata-sections
    -Wl,--gc-sections
lib_deps = 
    ArduinoJson@^6.21.3
    WebSockets@^2.4.0
    ayushsharma82/ElegantOTA@^2.2.9
    densaugeo/base64@^1.4.0
    tzapu/WiFiManager@^2.0.17
    arduino-libraries/NTPClient@^3.2.1
    bblanchon/StreamUtils@^1.7.3
monitor_filters = 
    esp32_exception_decoder
    time
upload_protocol = esptool
upload_port = COM5
upload_flags = 
    --chip=esp32
    --before=default_reset
    --after=hard_reset
    --connect-attempts=10
